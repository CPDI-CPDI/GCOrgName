import requests
import pandas as pd
import xml.etree.ElementTree as ET
import re

# Function to remove namespaces
def remove_namespace(doc, namespace):
    ns = '{' + namespace + '}'
    nsl = len(ns)
    for elem in doc.iter():
        if elem.tag.startswith(ns):
            elem.tag = elem.tag[nsl:]
        if elem.attrib:
            for key in list(elem.attrib):
                if key.startswith(ns):
                    new_key = key[nsl:]
                    elem.attrib[new_key] = elem.attrib.pop(key)

# URL of the XML file
url = 'https://laws-lois.justice.gc.ca/eng/XML/F-11.xml'

# Send an HTTP GET request to the URL
response = requests.get(url)

# Check if the request was successful
if response.status_code == 200:
    # Parse the content of the request with ElementTree
    root = ET.fromstring(response.content)
    
    # Remove namespaces
    print("Removing namespaces...")
    remove_namespace(root, 'http://justice.gc.ca/lims')
    
    # Print the root element and its children to verify structure
    print("Root element tag:", root.tag)
    print("Root element children tags:")
    for child in root:
        print(child.tag)
    
    # Lists to hold English and French names
    english_names = []
    french_names = []
    
    # Find all Schedule elements
    schedules = root.findall('.//Schedule')
    print(f"Found {len(schedules)} Schedule elements.")

    # Iterate through Schedule elements and look for BilingualGroup with id="230579"
    for i, schedule in enumerate(schedules):
        print(f"Inspecting Schedule {i + 1}...")
        for elem in schedule.iter():
            print(f"Tag: {elem.tag}, Attributes: {elem.attrib}")
        
        section = schedule.find('.//BilingualGroup[@id="230579"]')
        
        # Add a print statement for debugging
        if section is not None:
            print("Section found: BilingualGroup[@id='230579']")
            
            # Extract all BilingualItemEn and BilingualItemFr elements
            english_items = section.findall('.//BilingualItemEn')
            french_items = section.findall('.//BilingualItemFr')
            
            # Append the text content to the respective lists
            for item in english_items:
                print("English item found:", item.text)
                english_names.append(item.text)
            
            for item in french_items:
                print("French item found:", item.text)
                french_names.append(item.text)
        else:
            print("Section not found in this schedule.")
    
    # Create a DataFrame
    data = {'English Name': english_names, 'French Name': french_names}
    df = pd.DataFrame(data)
    
    # Print the DataFrame
    print(df)
    
    # Save the DataFrame to a CSV file with UTF-8 encoding
    df.to_csv('FAA 4 names.csv', index=True, encoding='utf-8')
else:
    print(f'Failed to retrieve the XML file. Status code: {response.status_code}')
